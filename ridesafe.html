<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Nyc Bike Ride Safe</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
<!-- Custom CSS -->
    <link href="css/shop-item.css" rel="stylesheet">
    <link rel="stylesheet" href="css/alertify.min.css">
    <link rel="stylesheet" href="css/default.min.css">
    <script src="js/alertify.min.js"></script>
       <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Custom CSS -->
    <link href="css/shop-item.css" rel="stylesheet">
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
   
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <style>

  .menu {
    margin:0px auto;
}
 
.menu li {
    margin:0px;
    list-style:none;
    font-family:'Ek Mukta';
}
 
.menu a {
    transition:all linear 0.15s;
}
 

 
.menu .arrow {
    font-size:11px;
    line-height:0%;
}
 
/*----- Top Level -----*/
.menu > ul > li {
    float:left;
    display:inline-block;
    position:relative;
    font-size:19px;
}
 
.menu > ul > li > a {
    padding:10px 40px;
    display:inline-block;
    text-shadow:0px 1px 0px rgba(0,0,0,0.4);
}
 
.menu > ul > li:hover > a, .menu > ul > .current-item > a {
    background:#2e2728;
}
 
/*----- Bottom Level -----*/
.menu li:hover .sub-menu {
    z-index:1;
    opacity:1;
}
 
.sub-menu {
    width:160%;
    padding:5px 0px;
    position:absolute;
    top:100%;
    left:0px;
    z-index:-1;
    opacity:0;
    transition:opacity linear 0.15s;
    background:#2e2728;
}
 
.sub-menu li {
    display:block;
    font-size:16px;
}
 
.sub-menu li a {
    padding:10px 30px;
    display:block;
}
 
.sub-menu li a:hover, .sub-menu .current-item a {
    background:#3e3436;
}         
	
        html,
        body,
        #map-canvas {
            margin: 0;
            padding: 0;
            height: 100%;
        }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDbIwQc21ErxhqyY_B1lXB4yOMTEDsNGCQ&">
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
   <script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js">  </script>
    <script>
         var map;
  var overlays = [];
  var clusterLoaded = false;
  var directionsService = new google.maps.DirectionsService;
  var polylineOptionsActual = new google.maps.Polyline({
    strokeColor: '#2B1AFF',
    strokeOpacity: 1.0,
    strokeWeight: 10
    });
  var directionsDisplay = new google.maps.DirectionsRenderer({polylineOptions: polylineOptionsActual,suppressBicyclingLayer:true});
  var bikeLayer = new google.maps.BicyclingLayer();
  var image = {
      url: 'http://breatheproject.org/wp-content/uploads/2014/01/Breathe_ActionIcons_v2-28.png', // image is 512 x 512
      scaledSize: new google.maps.Size(32, 32),
  };
  var clusterIcon = {
      url: 'https://cdn3.iconfinder.com/data/icons/earthquake/500/earthquake-24-512.png', // image is 512 x 512
      scaledSize: new google.maps.Size(32, 32),
  };

  function initialize() {
      var mapOptions = {
          zoom: 14,
          center: new google.maps.LatLng(40.6960, -73.9933),
          mapTypeId: google.maps.MapTypeId.ROADMAP	

      };
      map = new google.maps.Map(document.getElementById('map-canvas'),
          mapOptions);
     
        bikeLayer.setMap(map);

      $.ajax({
          type: "GET",
          dataType: "json",
          url: "dab.php",
          data: {
              sataVariable: "here is some data send with GET method"
          },
          success: function(data) {

              pathArr = new Array(2, 2);
              var markers = new Array();;
              for (i = 0; i < data.points.length; i++) {

                  latlng = new google.maps.LatLng(data.points[i].lat, data.points[i].long);
                  var marker = new google.maps.Marker({
                      position: latlng,
                      map: map,
                      icon: image,
                      title: data.streets[i]
                  });
                  infowindow = new google.maps.InfoWindow();
                  streetName = data.streets[i];
                  markers.push(marker);
                  addInfoWindow(marker, streetName);

              }
          },
          error: function(data) {
              console.log(data);
          }



      });
      var clusters = [];
      makePostCall = function() {
          return $.ajax({
              type: "GET",
              dataType: "json",
              url: "teken.php",
              data: {
                  sataVariable: "here is some data send with GET method"
              },
              success: function(data) {

                  for (i = 0; i < data.points.length; i++) {

                      latlng = new google.maps.LatLng(data.points[i].lat, data.points[i].long);
                      var marker = new google.maps.Marker({
                          position: latlng,
                          map: map,
                          icon: clusterIcon
                      });
                      clusters.push(marker);
                  }

                  var markerCluster = new MarkerClusterer(map, clusters, {
                      imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m'
                  });
				
                  clusterLoaded = true;

              },
              error: function(data) {
                  console.log(data);
              }
          });
      }

  }

  function addInfoWindow(marker, streetName) {
      google.maps.event.addListener(marker, 'click', function() {
          contentString = '<div id="content">' +
              '<div>' +
              '<b>' +
              streetName +
              '</b><div id="bodyContent">' +
              '<button id="startbtn" onclick="myStartFunction()" class="btn btn-primary">Set Start</button> ' +
              '<button id="destbtn" onclick="myDestFunction()" class="btn btn-success">Destination</button>' +
              '<button onclick="calculateAndDisplayRoute()" class="btn btn-success">Go</button>' +
              '</div>';

          infowindow.setContent(contentString);
          infowindow.open(map, marker);
          getLocation(marker.position);

      });

  }

  function myStartFunction() {     
      starting = pointer;
	//  alert(starting);
      $('#startbtn').addClass('lighter');
  }

  function myDestFunction() {
      destination = pointer;
      $('#destbtn').addClass('lighter');
  }

  function getLocation(obj) {
      pointer = obj;
  }

  function calcDistance(p1, p2) {
      return (google.maps.geometry.spherical.computeDistanceBetween(p1, p2) /977).toFixed(2);
     // return 2;
  }

  function calculateAndDisplayRoute() {
 //     var disval = calcDistance(starting, destination);
  //    var timeval = disval / 0.33;
  //    var intdisval = (timeval) - (timeval % 1);
  //    var pointdisval = ((timeval % 1) * 60).toFixed(2); 
  
  
//      alert("The distance is : " + disval + " miles, It takes " + intdisval + " Minutes " + pointdisval + " seconds if you ride with max speed limit.");
	 if(!clusterLoaded){      
	  makePostCall();
	   $("#mapContainer").removeClass('col-md-12').addClass('col-md-9');
      $("#panelContainer").removeClass('hidden');
     }
    
      directionsService.route({
          origin: starting,
          destination: destination,
          travelMode: 'BICYCLING'
      }, function(response, status) {
          if (status === 'OK') {
			 
              directionsDisplay.setDirections(response);
			    var route = response.routes[0];
				if(route != undefined)
				   alert("Distance : "+route.legs[0].distance.text + " and Duration : "+route.legs[0].duration.text);
			  
          } else {
              window.alert('Directions request failed due to ' + status);
          }
      });
   directionsDisplay.setMap(map);	  
      directionsDisplay.setPanel(document.getElementById('right-panel'));
	 
  }
  google.maps.event.addDomListener(window, 'load', initialize);
      </script>



</head>

<body>


<div class="menu-wrap">
<center>
<nav class="navbar navbar-default navbar-static-top">
<div class="container">
<div class="navbar-header">
    <nav class="menu">
        <ul class="clearfix">
<li>
           <a href="#">Charts <span class="arrow">&#9660;</span></a>
 
                <ul class="sub-menu">
           <li>     <a href="datechart/datechart.html" target="_blank" > Date </a></li>
                    <li><a href="boroughs/boroughchart.html" target="_blank" >Borough </a></li>              
                    <li><a href = "zipcode/zip.html" target="_blank" > Zip Code</a> </li>
</li>
</ul>        
</ul>
    </nav>
     </div>
       </div>
        </nav>
        </center>
</div>

 

   <div class="container-fluid">

        <div class="row">

            <div id= "mapContainer" class="col-md-12">
                <div id="map-canvas"></div>
            </div>
            <div id = "panelContainer" class="col-md-3 hidden">
             <div  id="right-panel"></div>
           </div>
        </div>

    </div>
    </div>
    <!-- /.container -->

    <div class="container">

        <hr>

        <!-- Footer -->
        <footer>
            <div class="row">
                <div class="col-lg-12">
                    <p>Copyright Nyc Bike Safe Ride 2016</p>
                </div>
            </div>
        </footer>

    </div>
  </div>
  <div id="menu1" class="tab-pane fade">
    
  </div>
 <!--  <div id="menu2" class="tab-pane fade">
    <h3>Menu 2</h3>
    <p></p>
  </div> -->
</div>

    <!-- /.container -->

    <!-- jQuery -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>




</body>

</html>